<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Scopefuscator v1.4</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #1e1e1e;
        color: #e0e0e0;
        margin: 0;
        padding: 40px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    h1 {
        margin-bottom: 20px;
        color: #00ff9f;
    }
    textarea {
        width: 100%;
        max-width: 800px;
        height: 220px;
        background-color: #2c2c2c;
        color: #00ff9f;
        border: none;
        border-radius: 12px;
        padding: 15px;
        font-size: 14px;
        font-family: monospace;
        resize: vertical;
        box-shadow: 0 0 5px #00000080;
    }
    button {
        background-color: #00ff9f;
        color: #1e1e1e;
        border: none;
        border-radius: 12px;
        padding: 12px 24px;
        font-size: 16px;
        margin: 20px 0;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    button:hover {
        background-color: #00d48f;
    }
</style>
</head>
<body>
<h1>Scopefuscator v1.4</h1>
<textarea id="inputCode" placeholder="Paste your LuaU script here..."></textarea>
<button onclick="obfuscateCode()">Obfuscate</button>
<textarea id="outputCode" readonly></textarea>

<script>
function obfuscateLua(source, key) {
    // Simple XOR encryption
    function xor(data, key) {
        let result = '';
        for (let i = 0; i < data.length; i++) {
            result += String.fromCharCode(data.charCodeAt(i) ^ key);
        }
        return result;
    }

    // Convert string to hex
    function toHex(str) {
        return Array.from(str).map(c => ('0' + c.charCodeAt(0).toString(16)).slice(-2)).join('');
    }

    // Generate random variable names with only letters
    function randVar(len = 8) {
        const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
        let res = '';
        for (let i = 0; i < len; i++) {
            res += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return res;
    }

    // Create junk variables (only letters)
    const junkVars = [];
    for (let i = 0; i < 40; i++) {
        junkVars.push(`local ${randVar()}=${Math.floor(Math.random() * 99999)}`);
    }
    const junkVarsCode = junkVars.join(';');

    // Create junk functions (with no side effects)
    const junkFuncs = [];
    for (let i = 0; i < 5; i++) {
        junkFuncs.push(`function ${randVar()}() local x=0 for i=1,10 do x=x+i end return x end`);
    }
    const junkFuncsCode = junkFuncs.join(';');

    // XOR encrypt source
    const encrypted = xor(source, key);
    const hexEnc = toHex(encrypted);

    // Escape hexEnc for Lua string literal
    const safeHexEnc = hexEnc.replace(/\\/g, '\\\\').replace(/"/g, '\\"');

    // Compose the one-line obfuscated Lua code
    const obfuscatedCode =
`-- Scopefuscator
(functions=function()end)();${junkFuncsCode};${junkVarsCode};if (hookfunction ~= nil) or (hookmetamethod ~= nil) then error("Tampering detected") end;local bit32=bit32 or require("bit32");local function xor(d,k)local r={}for i=1,#d do r[i]=string.char(bit32.bxor(d:byte(i),k))end return table.concat(r)end;local function fromhex(h)return h:gsub("..",function(c)return string.char(tonumber(c,16))end)end;local d=fromhex("${safeHexEnc}");local f,err=loadstring(xor(d,${key}));if not f then error(err) end return f()`;

    return obfuscatedCode;
}

function obfuscateCode() {
    const input = document.getElementById('inputCode').value;
    if (!input.trim()) {
        document.getElementById('outputCode').value = '-- Paste some code first!';
        return;
    }
    const key = 0xAA;
    try {
        const result = obfuscateLua(input, key);
        document.getElementById('outputCode').value = result;
    } catch (e) {
        document.getElementById('outputCode').value = '-- Error: ' + e.message;
    }
}
</script>
</body>
</html>
